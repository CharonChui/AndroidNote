音视频基础知识
===


基本概念
---

- ***媒体***：是表示，传输，存储信息的载体，常人们见到的文字、声音、图像、图形等都是表示信息的媒体。
- ***多媒体***：是声音、动画、文字、图像和录像等各种媒体的组合，以图文并茂，生动活泼的动态形式表现出来，给人以很强的视觉冲击力，留下深刻印象.
- ***多媒体技术***：是将文字、声音、图形、静态图像、动态图像与计算集成在一起的技术。它要解决的问题是计算机进一步帮助人类按最自然的和最习惯的方式接受和处理信息。
- ***流媒体***：流媒体是指采用流式传输的方式在`Internet`播放的连续时基媒体格式，实际指的是一种新的媒体传送方式，而不是一种新的媒体格式（在网络上传输音/视频等多媒体信息现在主要有下载和流式传输两种方式）流式传输分两种方法：实时流式传输方式(`Realtime Streaming`)和顺序流式传输方式(`Progressive Streaming`)。
- ***多媒体文件***:是既包括视频又包括音频，甚至还带有脚本的一个集合，也可以叫容器。
- ***媒体编码***:是文件当中的视频和音频所采用的压缩算法。也就是说一个`avi`的文件，当中的视频编码有可能是`A`，也可能是`B`，而其音频编码有可能是`1`，也有可能是`2`。
- ***转码***:指将一段多媒体包括音频、视频或者其他的内容从一种编码格式转换成为另外一种编码格式。
- ***帧***:帧就是一段数据的组合，它是数据传输的基本单位。就是影像动画中最小单位的单幅影像画面，相当于电影胶片上的每一格镜头。一帧就是一副静止的画面，连续的帧就形成动画，如电视图像等。
- ***视频***：连续的图象变化每秒超过24帧(`Frame`)画面以上时，根据视觉暂留原理，人眼无法辨别单幅的静态画面，看上去是平滑连续的视觉效果，这样连续的画面叫做视频.
- ***音频***:人类能听到的声音都成为音频，但是一般我们所说到的音频时存储在计算机里的声音。
- ***码率***:码率就是数据传输时单位时间传送的数据位数,一般我们用的单位是`kbps`即千位每秒。 通俗一点的理解就是取样率，单位时间内取样率越大，精度就越高，处理出来的文件就越接近原始文件，但是文件体积与取样率是成正比的，所以几乎所有的编码格式重视的都是如何用最低的码率达到最少的失真。但是因为编码算法不一样，所以也不能用码率来统一衡量音质或者画质.
- ***帧率***:帧/秒(`frames per second`)的缩写帧率即每秒显示帧数，帧率表示图形处理器处理场时每秒钟能够更新的次数。高的帧率可以得到更流畅、更逼真的动画。一般来说`30fps`就是可以接受的，但是将性能提升至`60fps`则可以明显提升交互感和逼真感，但是一般来说超过`75fps`一般就不容易察觉到有明显的流畅度提升了。如果帧率超过屏幕刷新率只会浪费图形处理的能力，因为监视器不能以这么快的速度更新，这样超过新率的帧率就浪费掉了。
- ***关键帧***:相当于二维动画中的原画，指角色或者物体运动或变化中的关键动作所处的那一帧，它包含了图像的所有信息，后来帧仅包含了改变了的信息。如果你没有足够的关键帧，你的影片品质可能比较差，因为所有的帧从别的帧处产生。对于一般的用途，一个比较好的原则是每5秒设一个关键键。但如果时那种实时传输的流文件，那么要考虑传输网络的可靠度，所以要1到2秒增加一个关键帧。




视频格式(封装格式/容器)
---

目前我们经常见的视频格式无非就是两大类： 

1. 影像格式（Video）
2. 流媒体格式（Stream Video）

在影像格式中还可以根据出处划分为三大种:   

1. `AVI`格式      
    `AVI`英文全称为`Audio Video Interleaved`，即音频视频交错格式，是微软公司于1992年11月推出、作为其`Windows`视频软件一部分的一种多媒体容器格式。
    `AVI`文件将音频（语音）和视频（影像）数据包含在一个文件容器中，允许音视频同步回放。类似`DVD`视频格式，`AVI`文件支持多个音视频流。`AVI`信息主要应用在多媒体光盘上，用来保存电视、电影等各种影像信息。    
    其中数据块包含实际数据流，即图像和声音序列数据。这是文件的主体，也是决定文件容量的主要部分。视频文件的大小等于该文件的数据率乘以该视频播放的时间长度，
    索引块包括数据块列表和它们在文件中的位置，以提供文件内数据随机存取能力。文件头包括文件的通用信息，定义数据格式，所用的压缩算法等参数。      
    `AVI`没有`MPEG`这么复杂，从`Windows 3.1`时代，它就已经面世了。它最直接的优点就是兼容好、调用方便而且图象质量好，因此也常常与`DVD`相并称。
    但它的缺点也是十分明显的：体积大。也是因为这一点，我们才看到了`MPEG-1`和`MPEG-4`的诞生。2小时影像的`AVI`文件的体积与`MPEG-2`相差无几，
    不过这只是针对标准分辨率而言的：根据不同的应用要求，`AVI`的分辨率可以随意调。窗口越大，文件的数据量也就越大。降低分辨率可以大幅减低它的体积，
    但图象质量就必然受损。与`MPEG-2`格式文件体积差不多的情况下，`AVI`格式的视频质量相对而言要差不少，但制作起来对电脑的配置要求不高，经常有人先录制好了`AVI`格式的视频，再转换为其他格式。
2. `MOV`格式
    `MOV`即`QuickTime`影片格式，它是`Apple`公司开发的一种音频、视频文件格式，用于存储常用数字媒体类型。当选择`QuickTime（*.mov）`作为“保存类型”时，动画将保存为`·mov`文件。`QuickTime`用于保存音频和视频信息，包括`Apple Mac OS，MicrosoftWindows95/98/NT/2003/XP/VISTA`，甚至`WINDOWS7`在内的所有主流电脑平台支持。`QuickTime`因具有跨平台、存储空间要求小等技术特点，而采用了有损压缩方式的`MOV`格式文件，画面效果较AVI格式要稍微好一些。到目前为止，它共有4个版本，其中以`4.0`版本的压缩率最好。这种编码支持16位图像深度的帧内压缩和帧间压缩，帧率每秒10帧以上。这种格式有些非编软件也可以对它实行处理，其中包括`ADOBE`公司的专业级多媒体视频处理软件`AFTEREFFECTS和PREMIERE`。

3. `MPEG/MPG/DAT`:
    这是由国际标准化组织`ISO(International Standards Organization)`与`IEC(International Electronic Committee)`联合开发的一种编码视频格式。`MPEG`是运动图像压缩算法的国际标准，现已被几乎所有的计算机平台共同支持。MPEG也是`Motion Picture Experts Group`的缩写。这类格式包括了`MPEG-1, MPEG-2`和`MPEG-4`在内的多种视频格式。`MPEG-1`相信是大家接触得最多的了，因为目前其正在被广泛地应用在`VCD`的制作和一些视频片段下载的网络应用上面，大部分的`VCD`都是用 `MPEG1`格式压缩的( 刻录软件自动将`MPEG1`转为`.DAT`格式)，使用`MPEG-1`的压缩算法，可以把一部120分钟长的电影压缩到1.2GB左右大小。`MPEG-2`则是应用在`DVD` 的制作，同时在一些`HDTV`（高清晰电视广播）和一些高要求视频编辑、处理上面也有相当多的应用。使用`MPEG-2`的压缩算法压缩一部120分钟长的电影可以压缩到5-8GB的大小（`MPEG2`的图像质量`MPEG-1`与其无法比拟的）。

在流媒体格式中同样还可以划分为三种:      

1. `RM`格式
    `Real Networks`公司所制定的音频/视频压缩规范`Real Media`中的一种，`Real Player`能做的就是利用`Internet`资源对这些符合`Real Media`技术规范的音频/视频进行实况转播。在`Real Media`规范中主要包括三类文件：`RealAudio`、`Real Video`和`Real Flash`（`Real Networks`公司与`Macromedia`公司合作推出的新一代高压缩比动画格式）。`REAL VIDEO`（RA、RAM）格式由一开始就是定位就是在视频流应用方面的，也可以说是视频流技术的始创者。它可以在用56K`MODEM`拨号上网的条件实现不间断的视频播放，从`RealVideo`的定位来看，就是牺牲画面质量来换取可连续观看性。其实`RealVideo`也可以实现不错的画面质量，由于`RealVideo`可以拥有非常高的压缩效率，很多人把`VCD`编码成`RealVideo`格式的，这样一来，一张光盘上可以存放好几部电影。`REAL VIDEO`存在颜色还原不准确的问题，`RealVideo`就不太适合专业的场合，但`RealVideo`出色的压缩效率和支持流式播放的特征，使得`RealVideo`在网络和娱乐场合占有不错的市场份额。
2. `MOV/QT`格式
    `MOV`也可以作为一种流文件格式。`QuickTime`能够通过`Internet`提供实时的数字化信息流、工作流与文件回放功能，为了适应这一网络多媒体应用，`QuickTime`为多种流行的浏览器软件提供了相应的`QuickTime Viewer`插件，能够在浏览器中实现多媒体数据的实时回放。
3. `ASF`格式
    `ASF`(`Advanced Streaming format`高级流格式)。`ASF`是`MICROSOFT`为了和现在的`Real player`竞争而发展出来的一种可以直接在网上观看视频节目的文件压缩格式。`ASF`使用了`MPEG4`的压缩算法，压缩率和图像的质量都很不错。因为`ASF`是以一个可以在网上即时观赏的视频“流”格式存在的，所以它的图像质量比`VCD`差一点点并不出奇，但比同是视频“流”格式的`RAM`格式要好。 `ASF`支持任意的压缩/解压缩编码方式，并可以使用任何一种底层网络传输协议，具有很大的灵活性。`ASF`流文件的数据速率可以在`28.8Kbps`到`3Mbps`之间变化。用户可以根据自己应用环境和网络条件选择一个合适的速率，实现`VOD`点播和直播。

4. `FLV`格式`FLV`是`FLASH VIDEO`的简称，一种流媒体封装格式，`FLV`流媒体格式是随着`Flash MX`的推出发展而来的视频格式。由于它形成的文件极小、加载速度极快，使得网络观看视频文件成为可能，它的出现有效地解决了视频文件导入`Flash`后，使导出的`SWF`文件体积庞大，不能在网络上很好的使用等问题。因此`FLV`格式成为了当今主流视频格式


音视频压缩编码标准
---


多媒体编辑码方式就是指通过特定的压缩技术，将某个视频格式的文件转换成另一种视频格式文件的方式，现在主要的编码方式有:    

- `MPEG`系列:由国际标准组织机构(`ISO`)下属的运动图象专家组(`MPEG`)开发。视频编码方面主要是`Mpeg1`、`Mpeg2`、`Mpeg4`、`Mpeg4 AVC`。音频编码方面主要是`MPEG Audio Layer 1/2`、`MPEG Audio Layer 3`、`MPEG-2 AAC`、`MPEG-4 AAC`等等:   

    - `MPEG-1`第二部分，主要使用在`VCD`上，有些在线视频也使用这种格式。该编解码器的质量大致上和原有的`VHS`录像带相当。
    - `MPEG-2`第二部分，等同于`H.262`，使用在`DVD`、`SVCD`和大多数数字视频广播系统和有线分布系统中。
    - `MPEG-4`第二部分，可以使用在网络传输、广播和媒体存储上。比起`MPEG-2`第二部分和第一版的`H.263`，它的压缩性能有所提高。
    - `MPEG-4`第十部分，等同于`H.264`，是这两个编码组织合作诞生的标准。


- `H.26X`系列：由国际电传视讯联盟远程通信标准化组织(`ITU-T`)主导，包括`H.261`、`H.262`、`H.263`、`H.264`、`H.265`。
    - `H.261`主要用于老的视频会议和视频电话系统。是第一个使用的数字视频压缩标准。实质上说，之后的所有的标准视频编解码器都是基于它设计的。
    - `H.262`等同于`MPEG-2`第二部分，使用在`DVD`、`SVCD`和大多数数字视频广播系统和有线分布系统中。
    - `H.263`主要用于视频会议、视频电话和网络视频相关产品。在对逐行扫描的视频源进行压缩的方面，`H.263` 比它之前的视频编码标准在性能上有了较大的提升。尤其是在低码率端，它可以在保证一定质量的前提下大大的节约码率。
    - `H.264`等同于`MPEG-4`第十部分，也被称为高级视频编码(`Advanced Video Coding`，简称 `AVC`)，是一种视频压缩标准，一种被广泛使用的高精度视频的录制、压缩和发布格式。该标准引入了一系列新的能够大大提高压缩性能的技术，并能够同时在高码率端和低码率端大大超越以前的诸标准。
    - `H.265`被称为高效率视频编码(`High Efficiency Video Coding`，简称`HEVC`)是一种视频压缩标准，是`H.264`的继任者。`HEVC` 被认为不仅提升图像质量，同时也能达到`H.264`两倍的压缩率（等同于同样画面质量下比特率减少了50%），可支持`4K` 分辨率甚至到超高画质电视，最高分辨率可达到`8192×4320`(`8K`分辨率)，这是目前发展的趋势。


- 微软`Windows Media`系列:视频编码有`Mpeg-4 v1/v2/v3`、`Windows Media Video 7/8/9/10`；音频编码有`Windows Media audeo v1/v2/7/8/9`。    
- `Real Media`系列:视频编码有`RealVideo G2`、`RealVideo 8/9/10`；音频编码有`RealAudio cook/sipro`、`RealAudio AAC/AACPlus`等。  
- `QuickTime`系列:视频编码有`Sorenson Video 3`、`Apple MPEG-4`、`Apple H.264`；音频编码有`QDesign Music 2`、`Apple MPEG-4 AAC`。   
- 其它如：`Ogg`、`On2-vpx`、`flash vidio`，以及`M-JPEG`视频压缩方式。    


#### 音频编解码方式

视频中除了画面通常还有声音，所以这就涉及到音频编解码。在视频中经常使用的音频编码方式有: 

- `AAC`:(`Advanced Audio Coding`)，是由`Fraunhofer IIS`、`杜比实验室`、`AT&T`、`Sony`等公司共同开发，在1997年推出的基于`MPEG-2` 的音频编码技术。2000年，`MPEG-4`标准出现后，`AAC`重新集成了其特性，加入了`SBR`技术和`PS`技术，为了区别于传统的`MPEG-2 AAC`又称为`MPEG-4 AAC`。
- `MP3`:(`MPEG-1 or MPEG-2 Audio Layer III`)，是当曾经非常流行的一种数字音频编码和有损压缩格式，它被设计来大幅降低音频数据量。它是在1991 年，由位于德国埃尔朗根的研究组织`Fraunhofer-Gesellschaft`的一组工程师发明和标准化的。`MP3`的普及曾对音乐产业造成极大的冲击与影响。
- `WMA`:(`Windows Media Audio`)由微软公司开发的一种数字音频压缩格式，本身包括有损和无损压缩格式。


一些音视频的参数含义
---

***声道***：目前人们所使用的各种声场技术规范非常多，但最常见的几乎都来自三家公司，他们是`Dolby`（杜比）、`HTX`和`DTS`。

声卡所支持的声道数是衡量声卡档次的重要指标之一，从单声道到最新的环绕立体声，下面一一详细介绍：

- 单声道：单声道是比较原始的声音复制形式，早期的声卡采用的比较普遍。当通过两个扬声器回放单声道信息的时候，我们可以明显感觉到声音是从两个音箱中间传递到我们耳朵里的。
这种缺乏位置感的录制方式用现在的眼光看自然是很落后的，但在声卡刚刚起步时，已经是非常先进的技术了。
- 立体声：单声道缺乏对声音的位置定位，而立体声技术则彻底改变了这一状况。声音在录制过程中被分配到两个独立的声道，从而达到了很好的声音定位效果。
这种技术在音乐欣赏中显得尤为有用，听众可以清晰地分辨出各种乐器来自的方向，从而使音乐更富想象力，更加接近于临场感受。立体声技术广泛运用于自`Sound Blaster Pro`以后的大量声卡，成为了影响深远的一个音频标准。时至今日，立体声依然是许多产品遵循的技术标准。
- 准立体声：准立体声声卡的基本概念就是：在录制声音的时候采用单声道，而放音有时是立体声，有时是单声道。采用这种技术的声卡也曾在市面上流行过一段时间，但现在已经销声匿迹了。
- 四声道环绕：人们的欲望是无止境的，立体声虽然满足了人们对左右声道位置感体验的要求，但是随着技术的进一步发展，大家逐渐发现双声道已经越来越不能满足我们的需求。
由于`PCI`声卡的出现带来了许多新的技术，其中发展最为神速的当数三维音效。三维音效的主旨是为人们带来一个虚拟的声音环境，通过特殊的HRTF技术营造一个趋于真实的声场，
从而获得更好的游戏听觉效果和声场定位。而要达到好的效果，仅仅依靠两个音箱是远远不够的，所以立体声技术在三维音效面前就显得捉襟见肘了，但四声道环绕音频技术则很好的解决了这一问题。
四声道环绕规定了4个发音点：前左、前右，后左、后右，听众则被包围在这中间。同时还建议增加一个低音音箱，以加强对低频信号的回放处理(这也就是如今4.1声道音箱系统广泛流行的原因)。
就整体效果而言，四声道系统可以为听众带来来自多个不同方向的声音环绕，可以获得身临各种不同环境的听觉感受，给用户以全新的体验。如今四声道技术已经广泛融入于各类中高档声卡的设计中，
成为未来发展的主流趋势。
- 5.1声道:5.1声道已广泛运用于各类传统影院和家庭影院中，一些比较知名的声音录制压缩格式，譬如杜比`AC-3`（`Dolby Digital`）、`DTS`等都是以5.1声音系统为技术蓝本的。其实5.1声音系统来源于4.1环绕，不同之处在于它增加了一个中置单元。这个中置单元负责传送低于`80Hz`的声音信号，在欣赏影片时有利于加强人声，把对话集中在整个声场的中部，以增加整体效果。相信每一个真正体验过`DolbyAC-3`音效的朋友都会为5.1声道所折服。千万不要以为5.1已经是环绕立体声的顶峰了，更强大的7.1系统已经出现了。
它在5.1的基础上又增加了中左和中右两个发音点，以求达到更加完美的境界。由于成本比较高，没有广泛普及。



流媒体协议
---
 
- `RTP`:(`Real-time Transport Protocol`)实时传输协议，是一种网络传输协议，运行在`UDP` 协议之上，`RTP`协议详细说明了在互联网上传递音频和视频的标准数据包格式。`RTP`协议常用于流媒体系统（配合`RTSP`协议）。

- `RTCP`:(Real-time Transport Control Protocol)或`RTP Control Protocol`或简写`RTCP`，实时传输控制协议，是实时传输协议（`RTP`）的一个姐妹协议。`RTCP`为`RTP`媒体流提供信道外(`out-of-band`)控制。`RTCP`本身并不传输数据，但和`RTP`一起协作将多媒体数据打包和发送。`RTCP` 定期在流多媒体会话参加者之间传输控制数据。`RTCP`的主要功能是为`RTP`所提供的服务质量（`Quality of Service`）提供反馈。

- `RTSP`:(`Real Time Streaming Protocol`)实时流传输协议实时流传输协议，是用来控制声音或影像的多媒体串流协议，`RTSP`提供了一个可扩展框架，使实时数据，如音频与视频的受控、点播成为可能。该协议定义了一对多应用程序如何有效地通过`IP`网络传送多媒体数据。`RTSP` 在体系结构上位于`RTP`和`RTCP`之上，它使用`TCP`或`UDP`完成数据传输。使用`RTSP`时，客户机和服务器都可以发出请求，即`RTSP`可以是双向的。
`RTSP`与`RTP`最大的区别在于：`RTSP`是一种双向实时数据传输协议，它允许客户端向服务器端发送请求，如回放、快进、倒退等操作。当然，`RTSP`可基于`RTP`来传送数据，还可以选择`TCP`、`UDP`、组播`UDP`等通道来发送数据，具有很好的扩展性。它时一种类似与`http`协议的网络应用层协议。

- `RTMP`:（`Real Time Messaging Protocol`)实时消息传送协议，是`Adobe Systems`公司为`Flash`播放器和服务器之间音频、视频和数据传输开发的开放协议。协议基于`TCP`，是一个协议族，包括`RTMP`基本协议及`RTMPT/RTMPS/RTMPE`等多种变种。`RTMP` 是一种设计用来进行实时数据通信的网络协议，主要用来在`Flash/AIR`平台和支持`RTMP`协议的流媒体/交互服务器之间进行音视频和数据通信。

- `HLS`:(`HTTP Live Streaming`)是苹果公司实现的基于`HTTP`的流媒体传输协议，可实现流媒体的直播和点播，主要应用在`IOS`系统，为`IOS`设备提供音视频直播和点播方案。`HLS`点播，基本上就是常见的分段`HTTP`点播，不同在于，它的分段非常小。相对于常见的流媒体直播协议，例如`RTMP`协议、`RTSP`协议、`MMS`协议等，`HLS`直播最大的不同在于，直播客户端获取到的，并不是一个完整的数据流。`HLS`协议在服务器端将
直播数据流存储为连续的、很短时长的媒体文件（`MPEG-TS`格式），而客户端则不断的下载并播放这些小文件。因为服务器端总是会将最新的直播数据生成新的小文件，这样客户端只要不停的按顺序播放从服务器获取到的文件，就实现了直播。由此可见，基本上可以认为，`HLS`是以点播的技术方式来实现直播。由于数据通过`HTTP`协议传输，所以完全不用考虑防火墙或者代理的问题，而且分段文件的时长很短，客户端可以很快的选择和切换码率，以适应不同带宽条件下的播放。不过`HLS`的这种技术特点，决定了它的延迟一般总是会高于普通的流媒体直播协议。

- `HTTP`:(`HyperText Transfer Protocol`)超文本传输协议，运行在`TCP`之上，这个协议是大家非常熟悉的，它也可以用到视频业务中来。 


***视频编码标准和音频编码标准是`H.264`和`AAC`，这两种标准分别是当今实际应用中编码效率最高的视频标准和音频标准。***


相关知识: 

- [封装格式](https://en.wikipedia.org/wiki/Comparison_of_video_container_formats)
- [视频编码方式](https://en.wikipedia.org/wiki/Comparison_of_video_codecs)
- [音频编码方式](https://en.wikipedia.org/wiki/Comparison_of_audio_coding_formats)

---

- 邮箱 ：charon.chui@gmail.com  
- Good Luck! 